---
description: 'null'
keywords: 操作の順序;ID サービス
seo-description: 'null'
seo-title: データ収集 CNAME およびクロスドメイントラッキング
title: データ収集 CNAME およびクロスドメイントラッキング
uuid: ba42c822-b677-4139-b1ed-4d98d3320fd0
translation-type: ht
source-git-commit: e6d65f1bfed187d7440512e8f3c2de0550506c95

---


# データ収集 CNAME およびクロスドメイントラッキング{#data-collection-cnames-and-cross-domain-tracking}

メインのエントリサイトがあり、顧客が他のドメインを訪問する前にメインのエントリサイトで顧客の識別ができる場合には、CNAME を使用することで、サードパーティ Cookie を受け入れないブラウザー（Safari など）でもクロスドメイントラッキングをおこなうことができます。

サードパーティ Cookie を受け入れるブラウザーでは、訪問者 ID をリクエストしたときに、データ収集サーバーによって Cookie が設定されます。訪問者 ID サービスはこの Cookie を使用することで、同じ Experience Cloud 組織 ID を使用するように設定されているすべてのドメインで、同じ Experience Cloud 訪問者 ID を返すことができます。

サードパーティ Cookie を受け入れないブラウザーでは、各ドメインに対して新しい Experience Cloud 訪問者 ID が割り当てられます。

訪問者 ID サービスでは、demdex.net Cookie を利用することで、Cookie を受け入れて複数のドメインにまたがって使用できるブラウザーでも、Cookie を受け入れないブラウザーでも、Analytics の s_vi Cookie と同じレベルのクロスドメイントラッキングを実現できます。

## データ収集 CNAME {#section-48fd186d376a48079769d12c4bd9f317}

Analytics Cookie がデータ収集サーバーによって設定されていたときには、多くの企業が、サードパーティ Cookie を拒否するブラウザーの問題を回避するために、[ファーストパーティ Cookie 実装](https://marketing.adobe.com/resources/help/ja_JP/whitepapers/first_party_cookies/)の一部としてデータ収集サーバーの CNAME レコードを設定していました。このプロセスでは、データ収集サーバーのドメインを Web サイトのドメインと一致させることで、訪問者 ID Cookie がファーストパーティ Cookie として設定されるようにしていました。

しかし訪問者 ID サービスでは、JavaScript を使用して現在の Web サイトのドメインに直接訪問者 Cookie を設定するので、そのような方法でファーストパーティ Cookie を設定する必要はなくなりました。

単一の Web プロパティ（単一のドメイン）を持つお客様は、データ収集 CNAME を廃止し、代わりにデフォルトのデータ収集ホスト名を使用できます（`omtrdc.net` または `2o7.net`）。

ただし、データ収集で CNAME を使用すると、サードパーティ Cookie を受け入れないブラウザーでも、メインのランディングドメインとその他のドメインにまたがって訪問者を追跡できるというメリットがあります。複数の Web プロパティ（複数のドメイン）を持つ企業では、データ収集 CNAME を維持した方がメリットがある場合もあります。以下の節で、クロスドメイン訪問者トラッキングのしくみについて説明しています。

## CNAME によるクロスドメイントラッキングのしくみ {#section-78925af798e24917b9abed79de290ad9}

Apple Safari などのブラウザーではファーストパーティ Cookie をサードパーティのコンテキストで使用できるしくみがあるため、CNAME を利用して、同じトラッキングサーバーを使用するプライマリドメインとその他のドメインとにまたがって顧客を追跡できます。

例えば、プライマリサイトが `mymainsite.com` にあるとします。CNAME レコードを設定して、セキュリティで保護されたデータ収集サーバー `smetrics.mymainsite.com` を参照します。

ユーザーが `mymainsite.com` を訪問すると、データ収集サーバーによって ID サービス Cookie が設定されます。これが可能であるのは、データ収集サーバーのドメインと Web サイトのドメインが一致しているからです。このような Cookie の使用方法を、「*ファーストパーティコンテキスト*」または単に「*ファーストパーティ Cookie*」と呼びます。

同じデータ収集サーバーを他のサイトでも使用し（例えば、`myothersiteB.com` と `myothersiteA.com` など）、訪問者が後でそのようなサイトを訪問する場合、`mymainsite.com` の訪問時に設定された Cookie がデータ収集サーバーへの HTTPS リクエストに含まれて送信されます（ブラウザーは Cookie が対応しているドメインが現在の Web サイトのドメインと一致していなくても、そのすべての Cookie をすべての HTTPS リクエストでそのドメインに送信することに注意してください）。このような Cookie の使用方法を、*サードパーティコンテキスト*&#x200B;または単に&#x200B;*サードパーティ Cookie* と呼びます。これにより、同じ訪問者 ID を他のドメインでも使用することができます。ブラウザーは、サードパーティのコンテキストの Cookie をファーストパーティ Cookie とは異なる方法で処理します。

*注意：Safari は、設定に関わらず、サードパーティコンテキストのすべての Cookie をブロックします。*

このことから、訪問者を複数のドメインで識別するには、ユーザーが共通して訪問するドメインを収集ドメインにする必要があります。データ収集ドメインとして使用できる&#x200B;*共通の*&#x200B;ドメインがない場合は、クロスドメイントラッキングのためにデータ収集ドメインの CNAME を保持するメリットはありません。訪問者がメインエントリサイトを最初に訪問しない場合は、セカンダリサイトとメインサイトで訪問者が異なる訪問者として識別されます。

## Experience Cloud Identity Service で CNAME サポートを有効にする {#section-25d4feb686d944e3a877d7aad8dbdf9a}

データ収集サーバーの CNAME のサポートは、`visitor.marketingCloudServerSecure` 変数を設定することで有効になります。
